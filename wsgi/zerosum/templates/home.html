{% extends "shared/base.html" %}


{% block script %}
$(function() {
    $('.balance .details').click(function () {console.log($(this).find('.list, .summary').toggle())}); 
});
{% endblock %}


{% block main %}
<!--h3>Recent Activity</h3>

<table class="table">
    <thead>
        <th>From/to</th>
        <th>Subject</th>
        <th style="text-align:right">Amount</th>
        <th>Created</th>
    </thead>
    {% for owe in owes %}
    <tr>
        <td>{{ owe.user_name }}</td>
        <td>{{ owe.subject }}</td>
        <td style="text-align:right" class="{{ owe.amount | plusminus }}">{{ owe.amount }} {{owe.currency }}</td>
        <td>{{ owe.created | dt }}</td>
    </tr>
    {% endfor %}
</table-->

{% macro owe_badge(owe, amount=True, length=30) %}
{% if owe.subject or amount %}
    <span class="{{ owe.amount | plusminus }} badge {% if owe.is_new %}new{% endif %}">
        {{ owe.subject | truncate(length) }} {{ owe.amount if amount }}
    </span>
{% else %}
    <span class="text-muted">no subject</span>
{% endif %}
{% endmacro %}

<h3>Current Balances</h3>

<table class="table balance">
    <thead>
        <th>User</th>
        <th style="text-align:right">Balance</th>
        <th>Items</th>
        <th>Latest Change</th>
    </thead>
    {% for b in balances %}
    <tr>
        <td>{{ b.usr.name }}</td>
        <td style="text-align:right" class="{{ b.amount | plusminus }}">{{ b.amount }} {{ b.currency }}</td>
        <td class="details">
            <div class="summary">
                {% for d in details[b.user_id] %}
                    {{ owe_badge(d, length=14) }}
                {% endfor %}
            </div>
            <div class="list">
                <table>
                {% for d in details[b.user_id] %}
                    <tr>
                        <td>{{ owe_badge(d, amount=False) }}</td>
                        <td style="text-align:right" class="{{ d.amount | plusminus }}">{{ d.amount }} {{d.currency }}</td>
                        <td>{{ d.created | dt }}</td>
                    </tr>
                {% endfor %}
                </table>
            </div>
        </td>
        <td>
            {{ b.latest | dt }}
        </td>
    </tr>
    {% endfor %}
    <tfoot>
        <tr>
            <th>Total</th>
            <td colspan="3">
                <span class="plus">{{ total[0] }}</span> / <span class="minus">{{ total[1] }}</span> EUR
            </td>
        </tr>
    </tfoot>
</table>

<h3>Actions</h3>

<div class="actions">
    <div class="row">
        <a href="/new_owe" class="btn btn-success col-sm-2"><span class="glyphicon glyphicon-plus"></span> New Owe</a>
        <div class="col-sm-10 text">
            Track that you owe someone and let him/her know.
        </div>
    </div>
    <div class="row">
        <a href="" class="btn btn-success col-sm-2 disabled"><span class="glyphicon glyphicon-plus"></span> Request Owe</a>
        <div class="col-sm-10 text">
            Someone owes you money? Remind them to add it!
        </div>
    </div>
</div>

<!--h3>New Owe</h3>

<form role="form" class="form-inline" method="POST" action="new_owe">
    I owe
    <input name="amount" type="number" step="0.01" min="0" placeholder="0.00"
        class="form-control" style="width: 100px" required/> &euro;
    <input name="currency" type="hidden" value="EUR">
    to
    <input name="creditor" class="form-control" list="emails" placeholder="friend@example.com"
        style="width:250px" required>
    <datalist id="emails">
        {% for b in balances %}
            <option value="{{ b.usr.name }} {{ '<' + b.usr.email + '>' if b.usr.name != b.usr.email}}">
        {% endfor %}
    </datalist>
    for
    <input name="subject" class="form-control" placeholder="subject" style="width:250px">
    <button type="submit" class="btn btn-primary">Confirm</button>
</form-->
{% endblock %}
